"use strict";(self["webpackJsonp_cfs-console"]=self["webpackJsonp_cfs-console"]||[]).push([[984],{49715:function(t,e,o){var n,s,r,a,i,l,u,c,d,m,p,v,g,h,f,y,$=o(2106),b=o(4969),_={queryVolList:(0,b.ZP)(n||(n=(0,$.Z)(["\n    query volList($cluster: String, $keywords: String) {\n      volList(cluster: $cluster, keywords: $keywords)\n    }\n  "]))),volMigrateStatus:(0,b.ZP)(s||(s=(0,$.Z)(["\n    query volMigrateStatus($cluster: String, $taskID: int) {\n      volMigrateStatus(cluster: $cluster, taskID: $taskID) {\n        status\n        volMigrateInfos {\n          name\n          status\n          migratePartitionCount\n          totalCount\n        }\n      }\n    }\n  "]))),volMigrateList:(0,b.ZP)(r||(r=(0,$.Z)(["\n    query volMigrateList(\n      $cluster: String\n      $module: String\n      $zone: String\n      $status: Int\n      $volume: String\n      $page: Int\n      $pageSize: Int\n    ) {\n      volMigrateList(\n        cluster: $cluster\n        module: $module\n        zone: $zone\n        status: $status\n        volume: $volume\n        page: $page\n        pageSize: $pageSize\n      ) {\n        total\n        data {\n          taskID\n          cluster\n          module\n          volumes\n          status\n          srcZone\n          dstZone\n          clusterConcurrency\n          volConcurrency\n          partitionConcurrency\n          waitSeconds\n          dstDataNodeUsageRatio\n          dstMetaPartitionLimit\n          createdAt\n          updatedAt\n        }\n      }\n    }\n  "]))),zoneList:(0,b.ZP)(a||(a=(0,$.Z)(["\n    query zoneList($cluster: String) {\n      zoneList(cluster: $cluster)\n    }\n  "]))),dropdownList:(0,b.ZP)(i||(i=(0,$.Z)(["\n    query dropdownList($cluster: String, $name: String, $taskType: Int) {\n      dropdownList(cluster: $cluster, name: $name, taskType: $taskType) {\n        opCode\n        opMsg\n      }\n    }\n  "]))),rebalanceList:(0,b.ZP)(l||(l=(0,$.Z)(["\n    query rebalanceList(\n      $cluster: String\n      $module: String\n      $zone: String\n      $status: Int\n      $taskType: Int\n      $page: Int\n      $pageSize: Int\n    ) {\n      rebalanceList(\n        cluster: $cluster\n        module: $module\n        zone: $zone\n        status: $status\n        taskType: $taskType\n        page: $page\n        pageSize: $pageSize\n      ) {\n        total\n        data {\n          taskID\n          cluster\n          module\n          taskType\n          zone\n          status\n          highRatio\n          lowRatio\n          goalRatio\n          concurrency\n          limitDPonDisk\n          limitMPonDstNode\n          createdAt\n          updatedAt\n        }\n      }\n    }\n  "]))),getNodeUsage:(0,b.ZP)(u||(u=(0,$.Z)(["\n    query getNodeUsage(\n      $cluster: String\n      $zone: String\n      $highRatio: int\n      $lowRatio: int\n      $module: String\n    ) {\n      getNodeUsage(\n        cluster: $cluster\n        zone: $zone\n        highRatio: $highRatio\n        lowRatio: $lowRatio\n        module: $module\n      ) {\n        nodes {\n          addr\n          usedRatio\n        }\n      }\n    }\n  "]))),resetVolMigrate:(0,b.ZP)(c||(c=(0,$.Z)(["\n    mutation resetVolMigrate(\n      $cluster: String\n      $taskID: int\n      $clusterConcurrency: int32\n      $volConcurrency: int32\n      $partitionConcurrency: int32\n      $waitSeconds: int32\n    ) {\n      resetVolMigrate(\n        cluster: $cluster\n        taskID: $taskID\n        clusterConcurrency: $clusterConcurrency\n        volConcurrency: $volConcurrency\n        partitionConcurrency: $partitionConcurrency\n        waitSeconds: $waitSeconds\n      )\n    }\n  "]))),stopVolMigrate:(0,b.ZP)(d||(d=(0,$.Z)(["\n    mutation stopVolMigrate($cluster: String, $taskID: int) {\n      stopVolMigrate(cluster: $cluster, taskID: $taskID)\n    }\n  "]))),createVolMigrate:(0,b.ZP)(m||(m=(0,$.Z)(["\n    mutation createVolMigrate(\n      $cluster: String\n      $module: String\n      $volList: [list]\n      $srcZone: String\n      $dstZone: String\n      $clusterConcurrency: int32\n      $volConcurrency: int32\n      $partitionConcurrency: int32\n      $waitSeconds: int32\n      $dstDataNodeUsageRatio: float64\n      $dstMetaPartitionLimit: int32\n    ) {\n      createVolMigrate(\n        cluster: $cluster\n        module: $module\n        volList: $volList\n        srcZone: $srcZone\n        dstZone: $dstZone\n        clusterConcurrency: $clusterConcurrency\n        volConcurrency: $volConcurrency\n        partitionConcurrency: $partitionConcurrency\n        waitSeconds: $waitSeconds\n        dstDataNodeUsageRatio: $dstDataNodeUsageRatio\n        dstMetaPartitionLimit: $dstMetaPartitionLimit\n      )\n    }\n  "]))),createRebalanceTask:(0,b.ZP)(p||(p=(0,$.Z)(["\n    mutation createRebalanceTask(\n      $cluster: String\n      $module: String\n      $zone: String\n      $highRatio: int32\n      $lowRatio: int32\n      $goalRatio: int32\n      $concurrency: int32\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n    ) {\n      createRebalanceTask(\n        cluster: $cluster\n        module: $module\n        zone: $zone\n        highRatio: $highRatio\n        lowRatio: $lowRatio\n        goalRatio: $goalRatio\n        concurrency: $concurrency\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n      )\n    }\n  "]))),createNodeMigrateTask:(0,b.ZP)(v||(v=(0,$.Z)(["\n    mutation createNodeMigrateTask(\n      $cluster: String\n      $module: String\n      $concurrency: int32\n      $srcNodeList: [list]\n      $dstNodeList: [list]\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n      $volList: [list]\n      $outRatio: float64\n    ) {\n      createNodeMigrateTask(\n        cluster: $cluster\n        module: $module\n        srcNodeList: $srcNodeList\n        dstNodeList: $dstNodeList\n        concurrency: $concurrency\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n        volList: $volList\n        outRatio: $outRatio\n      )\n    }\n  "]))),stopRebalanceTask:(0,b.ZP)(g||(g=(0,$.Z)(["\n    mutation stopRebalanceTask($cluster: String, $taskID: int32) {\n      stopRebalanceTask(cluster: $cluster, taskID: $taskID)\n    }\n  "]))),resetControlRebalanceTask:(0,b.ZP)(h||(h=(0,$.Z)(["\n    mutation resetControlRebalanceTask(\n      $cluster: String\n      $taskID: int32\n      $module: String\n      $concurrency: int32\n      $taskType: int32\n      $goalRatio: int32\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n    ) {\n      resetControlRebalanceTask(\n        cluster: $cluster\n        taskID: $taskID\n        module: $module\n        concurrency: $concurrency\n        taskType: $taskType\n        goalRatio: $goalRatio\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n      )\n    }\n  "]))),queryTaskStatus:(0,b.ZP)(f||(f=(0,$.Z)(["\n    query queryTaskStatus($taskID: int32) {\n      queryTaskStatus(taskID: $taskID) {\n        status\n        srcNodesInfo {\n          addr\n          isFinish\n          totalCount\n          migratedCount\n        }\n        dstNodesInfo {\n          addr\n          isFinish\n          totalCount\n          migratedCount\n        }\n      }\n    }\n  "]))),getConfigList:(0,b.ZP)(y||(y=(0,$.Z)(["\n    query getConfigList(\n      $cluster: String\n      $moduleType: Int\n      $operationType: int32\n      $volName: String\n    ) {\n      getConfigList(\n        cluster: $cluster\n        moduleType: $moduleType\n        operationType: $operationType\n        volName: $volName\n      ) {\n        valueName\n        valueDesc\n        valueType\n        value\n        valueForm\n      }\n    }\n  "])))};e.Z=_},80984:function(t,e,o){o.r(e),o.d(e,{default:function(){return m}});o(6203);var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"cluster"},[e("el-form",{ref:"form",attrs:{inline:!0,model:t.query,rules:t.rules}},[e("el-form-item",{attrs:{label:"集群：",required:"",prop:"cluster"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择"},on:{change:t.changeCluster},model:{value:t.query.cluster,callback:function(e){t.$set(t.query,"cluster",e)},expression:"query.cluster"}},t._l(t.clusterList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"模块：",prop:"module"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择",clearable:""},model:{value:t.query.module,callback:function(e){t.$set(t.query,"module",e)},expression:"query.module"}},t._l(t.moduleList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"源zone：",prop:"zone"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},model:{value:t.query.zone,callback:function(e){t.$set(t.query,"zone",e)},expression:"query.zone"}},t._l(t.zoneList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"状态：",prop:"status"}},[e("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择",clearable:""},model:{value:t.query.status,callback:function(e){t.$set(t.query,"status",e)},expression:"query.status"}},t._l(t.statusList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"卷：",prop:"volume"}},[e("el-select",{attrs:{filterable:"",clearable:"",remote:"",placeholder:"请选择卷名","remote-method":t.searchVolume},on:{change:t.changeVolume},model:{value:t.query.volume,callback:function(e){t.$set(t.query,"volume",e)},expression:"query.volume"}},t._l(t.volumeList,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),1)],1),t._v(" "),e("el-form-item",[e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.queryList("reset")}}},[t._v("查询")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:t.addTask}},[t._v("创建任务")])],1)],1),t._v(" "),e("el-table",{staticStyle:{width:"100%"},attrs:{data:t.list}},[e("el-table-column",{attrs:{prop:"taskID",label:"任务ID",fixed:"",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"cluster",label:"集群",fixed:"",width:"120"}}),t._v(" "),e("el-table-column",{attrs:{prop:"module",label:"模块",width:"80"}}),t._v(" "),e("el-table-column",{attrs:{prop:"volumes",label:"卷列表",width:"180"},scopedSlots:t._u([{key:"default",fn:function(o){return[e("span",[t._v(" "+t._s(o.row.volumes.join(",")))])]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"status",label:"状态",width:"100"},scopedSlots:t._u([{key:"default",fn:function(o){return[1==o.row.status?e("span",{staticClass:"success task"},[t._v(" 已完成")]):t._e(),t._v(" "),2==o.row.status?e("span",{staticClass:"pending task"},[t._v(" 迁移中")]):t._e(),t._v(" "),3==o.row.status?e("span",{staticClass:"stop task"},[t._v(" 停止")]):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"srcZone",label:"源zone",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"dstZone",label:"目标zone",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"clusterConcurrency",label:"集群并发",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"volConcurrency",label:"vol并发",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"partitionConcurrency",label:"分片并发",width:"100"}}),t._v(" "),e("el-table-column",{attrs:{prop:"waitSeconds",label:"每轮等待时间(秒)",width:"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"dstDataNodeUsageRatio",label:"目标节点阈值(data)",width:"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"dstMetaPartitionLimit",label:"目标节点分片数(meta)",width:"160"}}),t._v(" "),e("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",width:"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"updatedAt",label:"更新时间",width:"150"}}),t._v(" "),e("el-table-column",{attrs:{prop:"action",label:"操作",width:"150",fixed:"right"},scopedSlots:t._u([{key:"default",fn:function(o){return e("span",{staticClass:"active"},[e("span",{on:{click:function(e){return t.goDetail(o.row)}}},[t._v("详情")]),t._v(" "),2==o.row.status?e("span",{on:{click:function(e){return t.edit(o.row)}}},[t._v("| 编辑")]):t._e(),t._v(" "),2==o.row.status?e("span",{on:{click:function(e){return t.stopVol(o.row)}}},[t._v("| 停止")]):t._e()])}}])})],1),t._v(" "),e("div",{staticClass:"clearfix mt20"},[e("el-pagination",{staticClass:"fr",attrs:{"page-sizes":t.page.pageSizes,"page-size":t.page.pageSize,layout:"sizes, prev, pager, next",total:t.page.totalRecord},on:{"size-change":t.handleSizeChange,"current-change":t.handleCurrentChange}}),t._v(" "),e("span",{staticClass:"fr page-tips pr10"},[t._v(t._s(t.$t("chubaoFS.commonTxt.eachPageShows")))])],1),t._v(" "),e("el-dialog",{attrs:{title:"创建任务",visible:t.showAdd,width:"45%"},on:{"update:visible":function(e){t.showAdd=e}}},[e("el-form",{ref:"addForm",staticClass:"normalForm",attrs:{model:t.addForm,rules:t.addRules,"label-width":"130px"}},[e("el-form-item",{attrs:{label:"集群：",prop:"cluster",required:""}},[e("el-select",{staticStyle:{width:"300px"},attrs:{placeholder:"请选择"},on:{change:t.changeFormCluster},model:{value:t.addForm.cluster,callback:function(e){t.$set(t.addForm,"cluster",e)},expression:"addForm.cluster"}},t._l(t.clusterList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"模块：",prop:"module",required:""}},[e("el-radio-group",{attrs:{size:"small"},model:{value:t.addForm.module,callback:function(e){t.$set(t.addForm,"module",e)},expression:"addForm.module"}},[e("el-radio-button",{attrs:{label:"data"}},[t._v("data")]),t._v(" "),e("el-radio-button",{attrs:{label:"meta"}},[t._v("meta")])],1)],1),t._v(" "),e("el-form-item",{attrs:{label:"卷列表：",prop:"volList",required:""}},[e("el-select",{staticClass:"selectMulArea",staticStyle:{width:"300px"},attrs:{filterable:"",clearable:"",remote:"",multiple:"",placeholder:"请选择卷名","remote-method":t.searchVol},on:{change:t.changeVol},model:{value:t.addForm.volList,callback:function(e){t.$set(t.addForm,"volList",e)},expression:"addForm.volList"}},[t._l(t.volList,(function(t){return e("el-option",{key:t,attrs:{label:t,value:t}})})),t._v(" "),e("div",{staticClass:"custom-choose"},[e("span",{staticClass:"click",on:{click:function(e){return t.selectAll()}}},[t._v("全选")]),t._v(" "),t.addForm.volList&&t.addForm.volList.length>0?e("span",[t._v("(已选择"+t._s(t.addForm.volList.length)+"个）")]):t._e(),t._v(" "),e("span",{staticClass:"click right",on:{click:function(e){return t.delAll()}}},[t._v("取消")])])],2)],1),t._v(" "),e("el-form-item",{attrs:{label:"源zone：",prop:"srcZone",required:""}},[e("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},model:{value:t.addForm.srcZone,callback:function(e){t.$set(t.addForm,"srcZone",e)},expression:"addForm.srcZone"}},t._l(t.formZoneList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"目标zone：",prop:"dstZone",required:""}},[e("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},model:{value:t.addForm.dstZone,callback:function(e){t.$set(t.addForm,"dstZone",e)},expression:"addForm.dstZone"}},t._l(t.formZoneList,(function(t){return e("el-option",{key:t.opCode,attrs:{label:t.opMsg,value:t.opCode}})})),1)],1),t._v(" "),e("el-form-item",{attrs:{label:"集群并发：",prop:"clusterConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入集群并发",min:1},model:{value:t.addForm.clusterConcurrency,callback:function(e){t.$set(t.addForm,"clusterConcurrency",e)},expression:"addForm.clusterConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"vol并发：",prop:"volConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入vol并发",min:1},model:{value:t.addForm.volConcurrency,callback:function(e){t.$set(t.addForm,"volConcurrency",e)},expression:"addForm.volConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"分片并发：",prop:"partitionConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入分片并发",min:1},model:{value:t.addForm.partitionConcurrency,callback:function(e){t.$set(t.addForm,"partitionConcurrency",e)},expression:"addForm.partitionConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"每轮等待时间/S：",prop:"waitSeconds",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入每轮等待时间",min:1},model:{value:t.addForm.waitSeconds,callback:function(e){t.$set(t.addForm,"waitSeconds",e)},expression:"addForm.waitSeconds"}})],1),t._v(" "),"data"==t.addForm.module?e("el-form-item",{attrs:{label:"目标节点阈值：",prop:"dstDataNodeUsageRatio",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入目标节点阈值",min:0,max:1,step:.1},model:{value:t.addForm.dstDataNodeUsageRatio,callback:function(e){t.$set(t.addForm,"dstDataNodeUsageRatio",e)},expression:"addForm.dstDataNodeUsageRatio"}})],1):t._e(),t._v(" "),"meta"==t.addForm.module?e("el-form-item",{attrs:{label:"目标节点mp上限：",prop:"dstMetaPartitionLimit",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入目标节点阈值",min:1},model:{value:t.addForm.dstMetaPartitionLimit,callback:function(e){t.$set(t.addForm,"dstMetaPartitionLimit",e)},expression:"addForm.dstMetaPartitionLimit"}})],1):t._e()],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showAdd=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submit()}}},[t._v("确定")])],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"停止任务",visible:t.showStop,width:"40%"},on:{"update:visible":function(e){t.showStop=e}}},[e("div",{staticClass:"pb20"},[t._v("集群："+t._s(t.detail.cluster))]),t._v(" "),e("div",{staticClass:"pb20"},[t._v("任务ID："+t._s(t.detail.taskID))]),t._v(" "),e("div",{staticClass:"pb20"},[e("i",{staticClass:"el-icon-warning",staticStyle:{color:"#e6a23c","font-size":"16px"}}),t._v("\n      确定停止任务吗？\n    ")]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showStop=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.doStop()}}},[t._v("确定")])],1)]),t._v(" "),e("el-dialog",{attrs:{title:"编辑任务",visible:t.showEdit,width:"40%"},on:{"update:visible":function(e){t.showEdit=e}}},[e("el-form",{ref:"editForm",staticClass:"normalForm",attrs:{model:t.editForm,rules:t.editRules,"label-width":"130px"}},[e("el-form-item",{attrs:{label:"集群：",prop:"cluster"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{disabled:"",placeholder:""},model:{value:t.editForm.cluster,callback:function(e){t.$set(t.editForm,"cluster",e)},expression:"editForm.cluster"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"任务ID：",prop:"taskID"}},[e("el-input",{staticStyle:{width:"200px"},attrs:{disabled:"",placeholder:""},model:{value:t.editForm.taskID,callback:function(e){t.$set(t.editForm,"taskID",e)},expression:"editForm.taskID"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"集群并发：",prop:"clusterConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入集群并发",min:1},model:{value:t.editForm.clusterConcurrency,callback:function(e){t.$set(t.editForm,"clusterConcurrency",e)},expression:"editForm.clusterConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"vol并发：",prop:"volConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入vol并发",min:1},model:{value:t.editForm.volConcurrency,callback:function(e){t.$set(t.editForm,"volConcurrency",e)},expression:"editForm.volConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"分片并发：",prop:"partitionConcurrency",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入分片并发",min:1},model:{value:t.editForm.partitionConcurrency,callback:function(e){t.$set(t.editForm,"partitionConcurrency",e)},expression:"editForm.partitionConcurrency"}})],1),t._v(" "),e("el-form-item",{attrs:{label:"每轮等待时间/S：",prop:"waitSeconds",required:""}},[e("el-input-number",{attrs:{placeholder:"请输入每轮等待时间",min:1},model:{value:t.editForm.waitSeconds,callback:function(e){t.$set(t.editForm,"waitSeconds",e)},expression:"editForm.waitSeconds"}})],1)],1),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showEdit=!1}}},[t._v("取消")]),t._v(" "),e("el-button",{attrs:{type:"primary"},on:{click:function(e){return t.submitEdit()}}},[t._v("确定")])],1)],1),t._v(" "),e("el-dialog",{attrs:{title:"任务进度详情",visible:t.showDetail,width:"60%"},on:{"update:visible":function(e){t.showDetail=e}}},[e("div",{staticClass:"detail pb20"},[e("span",{staticClass:"label"},[t._v(" 集群：")]),t._v(" "),e("span",{staticClass:"value pr20"},[t._v(t._s(t.taskDetail.cluster))]),t._v(" "),e("span",{staticClass:"label"},[t._v(" 任务ID：")]),t._v(" "),e("span",{staticClass:"value pr20"},[t._v(t._s(t.taskDetail.taskID))]),t._v(" "),e("span",{staticClass:"label"},[t._v(" 模块：")]),t._v(" "),e("span",{staticClass:"value pr20"},[t._v(t._s(t.taskDetail.module))]),t._v(" "),e("span",{staticClass:"label"},[t._v(" 源Zone：")]),t._v(" "),e("span",{staticClass:"value pr20"},[t._v(t._s(t.taskDetail.srcZone))]),t._v(" "),e("span",{staticClass:"label"},[t._v(" 目标Zone：")]),t._v(" "),e("span",{staticClass:"value pr20"},[t._v(t._s(t.taskDetail.dstZone))]),t._v(" "),e("span",{staticClass:"label"},[t._v(" 状态：")]),t._v(" "),1==t.taskDetail.status?e("span",{staticClass:"success task"},[t._v(" 已完成")]):t._e(),t._v(" "),2==t.taskDetail.status?e("span",{staticClass:"pending task"},[t._v(" 迁移中")]):t._e(),t._v(" "),3==t.taskDetail.status?e("span",{staticClass:"stop task"},[t._v(" 停止")]):t._e()]),t._v(" "),e("div",{staticClass:"detailTable"},[e("el-table",{attrs:{data:t.taskDetail.table}},[e("el-table-column",{attrs:{type:"index",label:"#"}}),t._v(" "),e("el-table-column",{attrs:{prop:"name",label:"卷名"}}),t._v(" "),e("el-table-column",{attrs:{prop:"status",label:"迁移状态"},scopedSlots:t._u([{key:"default",fn:function(o){return[1==o.row.status?e("span",{staticClass:"success task"},[t._v("\n              已完成")]):t._e(),t._v(" "),2==o.row.status?e("span",{staticClass:"pending task"},[t._v("\n              迁移中")]):t._e(),t._v(" "),3==o.row.status?e("span",{staticClass:"stop task"},[t._v(" 停止")]):t._e()]}}])}),t._v(" "),e("el-table-column",{attrs:{prop:"migratePartitionCount",label:"已迁移分片数"}}),t._v(" "),e("el-table-column",{attrs:{prop:"totalCount",label:"总分片数"}})],1)],1),t._v(" "),e("div",{staticClass:"pt20 total"},[t._v("共"+t._s(t.taskDetail.table.length)+"条数据")]),t._v(" "),e("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[e("el-button",{on:{click:function(e){t.showDetail=!1}}},[t._v("关闭")])],1)])],1)},s=[],r=o(45736),a=o(37819),i=(o(69358),o(48324),o(79288),o(60228),o(49715)),l={name:"vol",components:{},data:function(){return{volumeList:[],volList:[],query:{cluster:void 0,module:void 0,status:null,zone:void 0,volume:void 0},rules:{cluster:[{required:!0,message:"请选择集群",trigger:"blur"}]},list:[],clusterList:[],moduleList:[],typeList:[],zoneList:[],statusList:[],page:{pageSizes:[10,20,30,40],pageNo:1,pageSize:10,totalRecord:0,totalPage:1},showAdd:!1,addForm:{cluster:"",module:"data",volList:[],srcZone:void 0,dstZone:void 0,clusterConcurrency:100,volConcurrency:50,partitionConcurrency:50,waitSeconds:120,dstDataNodeUsageRatio:.7,dstMetaPartitionLimit:3500},addRules:{cluster:[{required:!0,message:"请选择集群",trigger:"blur"}],volList:[{required:!0,message:"请选择卷",trigger:"blur"}],srcZone:[{required:!0,message:"请选择zone",trigger:"blur"}],dstZone:[{required:!0,message:"请选择类型",trigger:"blur"}],clusterConcurrency:[{required:!0,message:"请输入集群并发",trigger:"blur"}],volConcurrency:[{required:!0,message:"请输入volume并发",trigger:"blur"}],partitionConcurrency:[{required:!0,message:"请输入分片并发",trigger:"blur"}],waitSeconds:[{required:!0,message:"请输入每轮等待时间/S",trigger:"blur"}],dstDataNodeUsageRatio:[{required:!0,message:"请输入目标节点阈值（0-1）",trigger:"blur"}],dstMetaPartitionLimit:[{required:!0,message:"请输入目标节点分片数",trigger:"blur"}]},formZoneList:[],showStop:!1,detail:{},showDetail:!1,showEdit:!1,editForm:{taskID:void 0,cluster:"",volConcurrency:void 0,clusterConcurrency:void 0,partitionConcurrency:void 0,waitSeconds:void 0},editRules:{clusterConcurrency:[{required:!0,message:"请输入集群并发",trigger:"blur"}],volConcurrency:[{required:!0,message:"请输入volume并发",trigger:"blur"}],partitionConcurrency:[{required:!0,message:"请输入分片并发",trigger:"blur"}],waitSeconds:[{required:!0,message:"请输入每轮等待时间/S",trigger:"blur"}]},taskDetail:{cluster:"",taskID:null,module:"",srcZone:"",dstZone:"",status:"",table:[]},ipRatio:[]}},watch:{},filters:{formatStatus:function(t){switch(t){case 1:return"已完成";case 2:return"迁移中";case 3:return"停止"}}},methods:{selectAll:function(){this.addForm.volList=JSON.parse(JSON.stringify(this.volList))},delAll:function(){this.addForm.volList=[]},init:function(){var t=this;return(0,a.Z)((0,r.Z)().mark((function e(){return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.queryCluster();case 2:t.queryModule(),t.queryZoneList(),t.queryStatusList(),t.queryList();case 6:case"end":return e.stop()}}),e)})))()},changeCluster:function(){this.query.module=void 0,this.query.zone=void 0,this.query.status=void 0,this.queryModule(),this.queryZoneList(),this.queryStatusList(),this.queryList()},changeFormCluster:function(){this.queryZoneList("form"),this.queryVolumeList(null,"list"),this.addForm.volList=[],this.addForm.srcZone=void 0,this.addForm.dstZone=void 0},handleSizeChange:function(t){this.page.pageSize=t,this.queryList()},handleCurrentChange:function(t){this.page.pageNo=t,this.queryList()},addTask:function(){this.showAdd=!0,this.$refs["addForm"]&&this.$refs["addForm"].resetFields()},queryList:function(t){var e=this;this.$refs.form.validate((function(o){if(o){var n={page:t&&"reset"==t?1:Number(e.page.pageNo),pageSize:t&&"reset"==t?10:Number(e.page.pageSize)};Object.assign(n,e.query),n.status=Number(n.status),e.apollo.query(e.url.consoleSchedule,i.Z.volMigrateList,n).then((function(t){t.data?(e.list=t.data.volMigrateList.data?t.data.volMigrateList.data:[],e.page.totalRecord=t.data.volMigrateList.total):e.$message.error(t)})).catch((function(t){e.$message.error(t)}))}}))},queryCluster:function(){var t=this,e={taskType:3,name:"cluster"};return new Promise((function(o,n){t.apollo.query(t.url.consoleSchedule,i.Z.dropdownList,e).then((function(e){e.data?(t.clusterList=e.data.dropdownList?e.data.dropdownList:[],t.query.cluster=e.data.dropdownList.length>0?e.data.dropdownList[0].opCode:void 0):t.$message.error(e),o(e.data.dropdownList)})).catch((function(e){t.$message.error(e),n(e)}))}))},queryModule:function(){var t=this,e={name:"module",taskType:3,cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,i.Z.dropdownList,e).then((function(e){e.data?t.moduleList=e.data.dropdownList?e.data.dropdownList:[]:t.$message.error(e)})).catch((function(e){t.$message.error(e)}))},queryZoneList:function(t){var e=this,o={name:"zone",taskType:3,cluster:t&&"form"==t?this.addForm.cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,i.Z.dropdownList,o).then((function(o){o.data?t&&"form"==t?e.formZoneList=o.data.dropdownList?o.data.dropdownList:[]:e.zoneList=o.data.dropdownList?o.data.dropdownList:[]:(e.$message.error(o),t&&"form"==t?(e.formZoneList=[],e.addForm1.zone=void 0):(e.zoneList=[],e.query.zone=void 0))})).catch((function(t){e.$message.error(t)}))},queryStatusList:function(){var t=this,e={name:"status",taskType:3,cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,i.Z.dropdownList,e).then((function(e){e.data?t.statusList=e.data.dropdownList?e.data.dropdownList:[]:t.$message.error(e)})).catch((function(e){t.$message.error(e)}))},queryVolumeList:function(t,e){var o=this,n={keywords:t,cluster:e&&"list"==e?this.addForm.cluster:this.query.cluster};n.cluster&&""!=n.cluster&&this.apollo.query(this.url.volume,i.Z.queryVolList,n).then((function(t){t.data?e&&"list"==e?o.volList=t.data.volList||[]:o.volumeList=t.data.volList||[]:o.$Message.error(t)})).catch((function(t){o.$Message.error(t)}))},searchVolume:function(t){""!=t&&this.queryVolumeList(t)},changeVolume:function(){},searchVol:function(t){""!=t&&this.queryVolumeList(t,"list")},changeVol:function(){},submitTask:function(){var t=this,e={};Object.assign(e,this.addForm),this.apollo.mutation(this.url.consoleSchedule,i.Z.createVolMigrate,e).then((function(e){200==e.code?(t.showAdd=!1,t.$message.success("操作成功！")):t.$message.error(e)})).catch((function(e){t.$message.error(e)}))},validForm:function(t){var e=this;return new Promise((function(o,n){e.$refs[t].validate((function(t){return t?(o(!0),!0):(o(!1),!1)}))}))},submit:function(){var t=this;return(0,a.Z)((0,r.Z)().mark((function e(){var o;return(0,r.Z)().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.validForm("addForm");case 2:o=e.sent,o&&(t.submitTask(),t.queryList("reset"));case 4:case"end":return e.stop()}}),e)})))()},stopVol:function(t){this.showStop=!0,this.detail=t},doStop:function(){var t=this,e={cluster:this.detail.cluster,taskID:this.detail.taskID};this.apollo.mutation(this.url.consoleSchedule,i.Z.stopVolMigrate,e).then((function(e){e.data?(t.showStop=!1,t.queryList("reset")):t.$message.error(e)})).catch((function(e){t.$message.error(e)}))},goDetail:function(t){this.showDetail=!0,Object.assign(this.taskDetail,t),this.getDetail(t.taskID,t.cluster)},getDetail:function(t,e){var o=this,n={cluster:e,taskID:Number(t)};this.apollo.query(this.url.consoleSchedule,i.Z.volMigrateStatus,n).then((function(t){if(t.data){if(t.data.volMigrateStatus){var e=t.data.volMigrateStatus;o.taskDetail.status=e.status,o.taskDetail.table=e.volMigrateInfos||[]}}else o.taskDetail={status:"",table:[]},o.$message.error(t)})).catch((function(t){o.$message.error(t)}))},edit:function(t){this.showEdit=!0,this.$refs["editForm"]&&this.$refs["editForm"].resetFields(),this.editForm.taskID=t.taskID,this.editForm.cluster=t.cluster,this.editForm.volConcurrency=t.volConcurrency,this.editForm.clusterConcurrency=t.clusterConcurrency,this.editForm.partitionConcurrency=t.partitionConcurrency,this.editForm.waitSeconds=t.waitSeconds},submitEdit:function(){var t=this;this.$refs.editForm.validate((function(e){e&&t.apollo.mutation(t.url.consoleSchedule,i.Z.resetVolMigrate,t.editForm).then((function(e){200==e.code?(t.showEdit=!1,t.$message.success("操作成功！"),t.queryList("reset")):t.$message.error(e)})).catch((function(e){t.$message.error(e)}))}))}},mounted:function(){this.init()}},u=l,c=o(1001),d=(0,c.Z)(u,n,s,!1,null,null,null),m=d.exports},6203:function(t,e,o){var n=o(79989),s=o(68844),r=o(94413),a=o(65290),i=o(16834),l=s([].join),u=r!==Object,c=u||!i("join",",");n({target:"Array",proto:!0,forced:c},{join:function(t){return l(a(this),void 0===t?",":t)}})}}]);