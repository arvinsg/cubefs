"use strict";(self["webpackJsonp_cfs-console"]=self["webpackJsonp_cfs-console"]||[]).push([[352],{90352:function(e,t,o){o.r(t),o.d(t,{default:function(){return D}});var s,a,i,r,l,n,d,c,u,m,p=function(){var e=this,t=e._self._c;return t("div",{staticClass:"cluster"},[t("el-form",{ref:"form",attrs:{inline:!0,model:e.query,rules:e.rules}},[t("el-form-item",{attrs:{label:"集群：",required:"",prop:"cluster"}},[t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择"},on:{change:e.changeCluster},model:{value:e.query.cluster,callback:function(t){e.$set(e.query,"cluster",t)},expression:"query.cluster"}},e._l(e.clusterList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"模块：",prop:"module"}},[t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.query.module,callback:function(t){e.$set(e.query,"module",t)},expression:"query.module"}},e._l(e.moduleList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"类型：",prop:"taskType"}},[t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.query.taskType,callback:function(t){e.$set(e.query,"taskType",t)},expression:"query.taskType"}},e._l(e.typeList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"zone：",prop:"zone"}},[t("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},model:{value:e.query.zone,callback:function(t){e.$set(e.query,"zone",t)},expression:"query.zone"}},e._l(e.zoneList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"状态：",prop:"status"}},[t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择",clearable:""},model:{value:e.query.status,callback:function(t){e.$set(e.query,"status",t)},expression:"query.status"}},e._l(e.statusList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",[t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.queryList("reset")}}},[e._v("查询")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:e.addTask}},[e._v("创建任务")])],1)],1),e._v(" "),t("el-table",{staticStyle:{width:"100%"},attrs:{data:e.list}},[t("el-table-column",{attrs:{prop:"taskID",label:"任务ID",fixed:"",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"cluster",label:"集群",fixed:"",width:"180"}}),e._v(" "),t("el-table-column",{attrs:{prop:"module",label:"模块",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"taskType",label:"类型",width:"180"},scopedSlots:e._u([{key:"default",fn:function(o){return[0==o.row.taskType?t("span",[e._v("全部")]):e._e(),e._v(" "),1==o.row.taskType?t("span",[e._v("zone自动均衡")]):e._e(),e._v(" "),2==o.row.taskType?t("span",[e._v("节点迁移")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"zone",label:"zone",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"status",label:"状态",width:"150"},scopedSlots:e._u([{key:"default",fn:function(o){return[1==o.row.status?t("span",{staticClass:"success task"},[e._v(" 已完成")]):e._e(),e._v(" "),2==o.row.status?t("span",{staticClass:"pending task"},[e._v(" 迁移中")]):e._e(),e._v(" "),3==o.row.status?t("span",{staticClass:"stop task"},[e._v(" 停止")]):e._e()]}}])}),e._v(" "),t("el-table-column",{attrs:{prop:"highRatio",label:"迁出阈值",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"lowRatio",label:"迁入阈值",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"goalRatio",label:"目标阈值",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"concurrency",label:"迁移并发",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"migrateLimitPerDisk",label:"dp limit",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"dstMetaPartitionMaxCount",label:"dst mp limit",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"createdAt",label:"创建时间",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"updatedAt",label:"更新时间",width:"150"}}),e._v(" "),t("el-table-column",{attrs:{prop:"action",label:"操作",width:"150",fixed:"right"},scopedSlots:e._u([{key:"default",fn:function(o){return t("span",{staticClass:"active"},[t("span",{on:{click:function(t){return e.goDetail(o.row)}}},[e._v("详情")]),e._v(" "),2==o.row.status?t("span",{on:{click:function(t){return e.edit(o.row)}}},[e._v("| 编辑")]):e._e(),e._v(" "),2==o.row.status?t("span",{on:{click:function(t){return e.stopBalance(o.row)}}},[e._v("| 停止")]):e._e()])}}])})],1),e._v(" "),t("div",{staticClass:"clearfix mt20"},[t("el-pagination",{staticClass:"fr",attrs:{"page-sizes":e.page.pageSizes,"page-size":e.page.pageSize,layout:"sizes, prev, pager, next",total:e.page.totalRecord},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}}),e._v(" "),t("span",{staticClass:"fr page-tips pr10"},[e._v(e._s(e.$t("chubaoFS.commonTxt.eachPageShows")))])],1),e._v(" "),t("el-dialog",{attrs:{title:"创建任务",visible:e.showAdd,width:"60%"},on:{"update:visible":function(t){e.showAdd=t}}},[t("el-form",{ref:"addForm",staticClass:"normalForm",attrs:{model:e.addForm,rules:e.addRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"集群：",prop:"cluster",required:""}},[t("el-select",{staticStyle:{width:"180px"},attrs:{placeholder:"请选择"},on:{change:e.changeFormCluster},model:{value:e.addForm.cluster,callback:function(t){e.$set(e.addForm,"cluster",t)},expression:"addForm.cluster"}},e._l(e.clusterList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"模块：",prop:"module",required:""}},[t("el-radio-group",{attrs:{size:"small"},model:{value:e.addForm.module,callback:function(t){e.$set(e.addForm,"module",t)},expression:"addForm.module"}},[t("el-radio-button",{attrs:{label:"data"}},[e._v("data")]),e._v(" "),t("el-radio-button",{attrs:{label:"meta"}},[e._v("meta")])],1)],1),e._v(" "),t("el-form-item",{attrs:{label:"迁移并发：",prop:"concurrency",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入迁移并发",min:1,max:400},model:{value:e.addForm.concurrency,callback:function(t){e.$set(e.addForm,"concurrency",t)},expression:"addForm.concurrency"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"类型：",prop:"taskType",required:""}},[t("el-radio-group",{attrs:{size:"small"},on:{change:e.changeType},model:{value:e.addForm.taskType,callback:function(t){e.$set(e.addForm,"taskType",t)},expression:"addForm.taskType"}},[t("el-radio-button",{attrs:{label:1}},[e._v("zone自动均衡")]),e._v(" "),t("el-radio-button",{attrs:{label:2}},[e._v("节点迁移")])],1)],1)],1),e._v(" "),t("el-form",{ref:"addForm1",staticClass:"normalForm",attrs:{model:e.addForm1,rules:e.addRules1,"label-width":"130px"}},["data"==e.addForm.module&&1==e.addForm.taskType?t("el-form-item",{attrs:{label:"最大迁出dp数/盘：",prop:"limitDPonDisk",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入最大迁出dp数/盘",min:1,max:100},model:{value:e.addForm1.limitDPonDisk,callback:function(t){e.$set(e.addForm1,"limitDPonDisk",t)},expression:"addForm1.limitDPonDisk"}})],1):e._e(),e._v(" "),"meta"==e.addForm.module?t("el-form-item",{attrs:{label:"目标节点mp上限：",prop:"limitMPonDstNode",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入目标节点mp上限",min:1},model:{value:e.addForm1.limitMPonDstNode,callback:function(t){e.$set(e.addForm1,"limitMPonDstNode",t)},expression:"addForm1.limitMPonDstNode"}})],1):e._e(),e._v(" "),1==e.addForm.taskType?t("el-form-item",{attrs:{label:"zone：",prop:"zone",required:""}},[t("el-select",{staticStyle:{width:"180px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},model:{value:e.addForm1.zone,callback:function(t){e.$set(e.addForm1,"zone",t)},expression:"addForm1.zone"}},e._l(e.formZoneList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1),e._v(" "),e.addForm1.zone&&""!=e.addForm1.zone?t("span",{staticClass:"click-color",on:{click:e.showRatio}},[e._v("\n          查看使用率")]):e._e()],1):e._e(),e._v(" "),1==e.addForm.taskType?t("el-form-item",{attrs:{label:"迁出阈值：",prop:"highRatio",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入阈值",min:0,max:1,step:.1},model:{value:e.addForm1.highRatio,callback:function(t){e.$set(e.addForm1,"highRatio",t)},expression:"addForm1.highRatio"}}),e._v(" "),t("el-tooltip",{attrs:{content:"筛选节点使用率高于该阈值的节点，作为迁出节点",placement:"top"}},[t("i",{staticClass:"el-icon-question click-color"})])],1):e._e(),e._v(" "),1==e.addForm.taskType?t("el-form-item",{attrs:{label:"迁入阈值：",prop:"lowRatio",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入阈值",min:0,max:1,step:.1},model:{value:e.addForm1.lowRatio,callback:function(t){e.$set(e.addForm1,"lowRatio",t)},expression:"addForm1.lowRatio"}}),e._v(" "),t("el-tooltip",{attrs:{content:"筛选节点使用率低于该阈值的节点，作为迁入节点",placement:"top"}},[t("i",{staticClass:"el-icon-question click-color"})])],1):e._e(),e._v(" "),1==e.addForm.taskType?t("el-form-item",{attrs:{label:"目标阈值：",prop:"goalRatio",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入阈值",min:0,max:1,step:.1},model:{value:e.addForm1.goalRatio,callback:function(t){e.$set(e.addForm1,"goalRatio",t)},expression:"addForm1.goalRatio"}}),e._v(" "),t("el-tooltip",{attrs:{content:"迁出节点使用率降到该阈值，停止迁出",placement:"top"}},[t("i",{staticClass:"el-icon-question click-color"})])],1):e._e(),e._v(" "),2==e.addForm.taskType?t("el-form-item",{attrs:{label:"源节点：",prop:"srcNodes",required:""}},[t("el-input",{attrs:{placeholder:"请选择节点",type:"textarea",rows:3},model:{value:e.addForm1.srcNodes,callback:function(t){e.$set(e.addForm1,"srcNodes",t)},expression:"addForm1.srcNodes"}}),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addNodeList(1)}}},[e._v("添加")])],1):e._e(),e._v(" "),2==e.addForm.taskType?t("el-form-item",{attrs:{label:"目标节点：",prop:"dstNodes",required:""}},[t("el-input",{attrs:{placeholder:"请选择节点",type:"textarea",rows:3},model:{value:e.addForm1.dstNodes,callback:function(t){e.$set(e.addForm1,"dstNodes",t)},expression:"addForm1.dstNodes"}}),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.addNodeList(2)}}},[e._v("添加")])],1):e._e()],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showAdd=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submit()}}},[e._v("确定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"选择节点",visible:e.showSelectNode,width:"40%"},on:{"update:visible":function(t){e.showSelectNode=t}}},[t("el-form",{ref:"selectForm",staticClass:"normalForm",attrs:{model:e.selectForm,rules:e.selectRules,"label-width":"80px"}},[t("el-form-item",{attrs:{label:"zone：",prop:"zone",required:""}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",clearable:"",placeholder:"请选择zone"},on:{change:e.queryIps},model:{value:e.selectForm.zone,callback:function(t){e.$set(e.selectForm,"zone",t)},expression:"selectForm.zone"}},e._l(e.formZoneList,(function(e){return t("el-option",{key:e.opCode,attrs:{label:e.opMsg,value:e.opCode}})})),1)],1),e._v(" "),t("el-form-item",{attrs:{label:"阈值：",prop:"highRatio"}},[t("el-input-number",{attrs:{placeholder:"请输入阈值",min:0,max:1,step:.1},on:{blur:e.changeHigh},model:{value:e.selectForm.highRatio,callback:function(t){e.$set(e.selectForm,"highRatio",t)},expression:"selectForm.highRatio"}}),e._v(" "),e.isHigh?t("el-tooltip",{attrs:{content:"筛选使用率高于该阈值的节点",placement:"top"}},[t("i",{staticClass:"el-icon-question click-color"})]):t("el-tooltip",{attrs:{content:"筛选使用率低于该阈值的节点",placement:"top"}},[t("i",{staticClass:"el-icon-question click-color"})])],1),e._v(" "),t("el-form-item",{attrs:{label:"ips：",prop:"ips",required:""}},[t("el-select",{staticStyle:{width:"300px"},attrs:{filterable:"",clearable:"",placeholder:"请选择ip",multiple:""},model:{value:e.selectForm.ips,callback:function(t){e.$set(e.selectForm,"ips",t)},expression:"selectForm.ips"}},e._l(e.ipList,(function(o){return t("el-option",{key:o.addr,attrs:{label:o.addr,value:o.addr}},[t("span",{staticStyle:{float:"left"}},[e._v(e._s(o.addr))]),e._v(" "),t("span",{staticStyle:{float:"right",color:"#8492a6","font-size":"13px"}},[e._v(e._s(o.usedRatio)+"(使用率)")])])})),1)],1)],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showSelectNode=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitIps()}}},[e._v("确定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"停止任务",visible:e.showStop,width:"40%"},on:{"update:visible":function(t){e.showStop=t}}},[t("div",{staticClass:"pb20"},[e._v("集群："+e._s(e.detail.cluster))]),e._v(" "),t("div",{staticClass:"pb20"},[e._v("\n      任务类型："),0==e.detail.taskType?t("span",[e._v("全部")]):e._e(),1==e.detail.taskType?t("span",[e._v("zone自动均衡")]):e._e(),2==e.detail.taskType?t("span",[e._v("节点迁移")]):e._e()]),e._v(" "),t("div",{staticClass:"pb20"},[t("i",{staticClass:"el-icon-warning",staticStyle:{color:"#e6a23c","font-size":"16px"}}),e._v("\n      确定停止rebalance吗？\n    ")]),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showStop=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.doStop()}}},[e._v("确定")])],1)]),e._v(" "),t("el-dialog",{attrs:{title:"编辑任务",visible:e.showEdit,width:"40%"},on:{"update:visible":function(t){e.showEdit=t}}},[t("el-form",{ref:"editForm",staticClass:"normalForm",attrs:{model:e.editForm,rules:e.editRules,"label-width":"130px"}},[t("el-form-item",{attrs:{label:"任务ID：",prop:"taskID"}},[t("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.editForm.taskID,callback:function(t){e.$set(e.editForm,"taskID",t)},expression:"editForm.taskID"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"集群：",prop:"cluster"}},[t("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.editForm.cluster,callback:function(t){e.$set(e.editForm,"cluster",t)},expression:"editForm.cluster"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"模块：",prop:"module"}},[t("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.editForm.module,callback:function(t){e.$set(e.editForm,"module",t)},expression:"editForm.module"}})],1),e._v(" "),t("el-form-item",{attrs:{label:"任务类型：",prop:"taskTypeName"}},[t("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.editForm.taskTypeName,callback:function(t){e.$set(e.editForm,"taskTypeName",t)},expression:"editForm.taskTypeName"}})],1),e._v(" "),1==e.editForm.taskType?t("el-form-item",{attrs:{label:"zone：",prop:"zone"}},[t("el-input",{attrs:{disabled:"",placeholder:""},model:{value:e.editForm.zone,callback:function(t){e.$set(e.editForm,"zone",t)},expression:"editForm.zone"}})],1):e._e(),e._v(" "),t("el-form-item",{attrs:{label:"迁移并发：",prop:"concurrency",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入迁移并发",min:1,max:400},model:{value:e.editForm.concurrency,callback:function(t){e.$set(e.editForm,"concurrency",t)},expression:"editForm.concurrency"}})],1),e._v(" "),1==e.editForm.taskType?t("el-form-item",{attrs:{label:"目标阈值：",prop:"goalRatio",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入阈值",min:0,max:1,step:.1},model:{value:e.editForm.goalRatio,callback:function(t){e.$set(e.editForm,"goalRatio",t)},expression:"editForm.goalRatio"}})],1):e._e(),e._v(" "),"meta"==e.editForm.module?t("el-form-item",{attrs:{label:"目标节点mp上限：",prop:"limitMPonDstNode",required:""}},[t("el-input-number",{attrs:{placeholder:"请输入目标节点mp上限",min:1,max:1e4},model:{value:e.editForm.limitMPonDstNode,callback:function(t){e.$set(e.editForm,"limitMPonDstNode",t)},expression:"editForm.limitMPonDstNode"}})],1):e._e()],1),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showEdit=!1}}},[e._v("取消")]),e._v(" "),t("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.submitEdit()}}},[e._v("确定")])],1)],1),e._v(" "),t("el-dialog",{attrs:{title:"任务进度详情",visible:e.showDetail,width:"60%"},on:{"update:visible":function(t){e.showDetail=t}}},[t("div",{staticClass:"pb20"},[e._v("\n      状态：\n      "),1==e.taskDetail.status?t("span",{staticClass:"success task"},[e._v(" 已完成")]):e._e(),e._v(" "),2==e.taskDetail.status?t("span",{staticClass:"pending task"},[e._v(" 迁移中")]):e._e(),e._v(" "),3==e.taskDetail.status?t("span",{staticClass:"stop task"},[e._v(" 停止")]):e._e()]),e._v(" "),t("div",{staticClass:"detailTable"},[t("div",{staticClass:"table left"},[t("span",{staticClass:"label"},[e._v("迁移原机器")]),e._v(" "),t("el-table",{attrs:{data:e.taskDetail.srcNodesInfo}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),e._v(" "),t("el-table-column",{attrs:{prop:"addr",label:"地址"}}),e._v(" "),t("el-table-column",{attrs:{prop:"isFinish",label:"迁移进度"},scopedSlots:e._u([{key:"default",fn:function(o){return[o.row.isFinish?t("span",[e._v("已完成")]):t("span",[e._v(e._s(o.row.migratedCount)+"/"+e._s(o.row.totalCount))])]}}])})],1)],1),e._v(" "),t("div",{staticClass:"table"},[t("span",{staticClass:"label"},[e._v("目标机器")]),e._v(" "),t("el-table",{attrs:{data:e.taskDetail.dstNodesInfo}},[t("el-table-column",{attrs:{type:"index",label:"#"}}),e._v(" "),t("el-table-column",{attrs:{prop:"addr",label:"地址"}})],1)],1)]),e._v(" "),t("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[t("el-button",{on:{click:function(t){e.showDetail=!1}}},[e._v("关闭")])],1)]),e._v(" "),t("el-dialog",{attrs:{title:"使用率详情",visible:e.isShowRatio,width:"40%"},on:{"update:visible":function(t){e.isShowRatio=t}}},[t("div",{staticClass:"addrArea"},e._l(e.ipRatio,(function(o){return t("li",{staticClass:"addrLine"},[e._v("\n        "+e._s(o.addr)+" (使用率："+e._s(o.usedRatio)+")\n      ")])})),0)])],1)},h=[],g=o(45736),f=o(37819),v=(o(79288),o(60228),o(6203),o(2106)),b=o(4969),y={zoneList:(0,b.ZP)(s||(s=(0,v.Z)(["\n    query zoneList($cluster: String) {\n      zoneList(cluster: $cluster)\n    }\n  "]))),dropdownList:(0,b.ZP)(a||(a=(0,v.Z)(["\n    query dropdownList($cluster: String, $name: String) {\n      dropdownList(cluster: $cluster, name: $name) {\n        opCode\n        opMsg\n      }\n    }\n  "]))),rebalanceList:(0,b.ZP)(i||(i=(0,v.Z)(["\n    query rebalanceList(\n      $cluster: String\n      $module: String\n      $zone: String\n      $status: Int\n      $taskType: Int\n      $page: Int\n      $pageSize: Int\n    ) {\n      rebalanceList(\n        cluster: $cluster\n        module: $module\n        zone: $zone\n        status: $status\n        taskType: $taskType\n        page: $page\n        pageSize: $pageSize\n      ) {\n        total\n        data {\n          taskID\n          cluster\n          module\n          taskType\n          zone\n          status\n          highRatio\n          lowRatio\n          goalRatio\n          concurrency\n          migrateLimitPerDisk\n          dstMetaPartitionMaxCount\n          createdAt\n          updatedAt\n        }\n      }\n    }\n  "]))),getNodeUsage:(0,b.ZP)(r||(r=(0,v.Z)(["\n    query getNodeUsage(\n      $cluster: String\n      $zone: String\n      $highRatio: int\n      $lowRatio: int\n      $module: String\n    ) {\n      getNodeUsage(\n        cluster: $cluster\n        zone: $zone\n        highRatio: $highRatio\n        lowRatio: $lowRatio\n        module: $module\n      ) {\n        nodes {\n          addr\n          usedRatio\n        }\n      }\n    }\n  "]))),createRebalanceTask:(0,b.ZP)(l||(l=(0,v.Z)(["\n    mutation createRebalanceTask(\n      $cluster: String\n      $module: String\n      $zone: String\n      $highRatio: int32\n      $lowRatio: int32\n      $goalRatio: int32\n      $concurrency: int32\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n    ) {\n      createRebalanceTask(\n        cluster: $cluster\n        module: $module\n        zone: $zone\n        highRatio: $highRatio\n        lowRatio: $lowRatio\n        goalRatio: $goalRatio\n        concurrency: $concurrency\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n      )\n    }\n  "]))),createNodeMigrateTask:(0,b.ZP)(n||(n=(0,v.Z)(["\n    mutation createNodeMigrateTask(\n      $cluster: String\n      $module: String\n      $concurrency: int32\n      $srcNodeList: [list]\n      $dstNodeList: [list]\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n    ) {\n      createNodeMigrateTask(\n        cluster: $cluster\n        module: $module\n        srcNodeList: $srcNodeList\n        dstNodeList: $dstNodeList\n        concurrency: $concurrency\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n      )\n    }\n  "]))),stopRebalanceTask:(0,b.ZP)(d||(d=(0,v.Z)(["\n    mutation stopRebalanceTask($cluster: String, $taskID: int32) {\n      stopRebalanceTask(cluster: $cluster, taskID: $taskID)\n    }\n  "]))),resetControlRebalanceTask:(0,b.ZP)(c||(c=(0,v.Z)(["\n    mutation resetControlRebalanceTask(\n      $cluster: String\n      $taskID: int32\n      $module: String\n      $concurrency: int32\n      $taskType: int32\n      $goalRatio: int32\n      $limitDPonDisk: int32\n      $limitMPonDstNode: int32\n    ) {\n      resetControlRebalanceTask(\n        cluster: $cluster\n        taskID: $taskID\n        module: $module\n        concurrency: $concurrency\n        taskType: $taskType\n        goalRatio: $goalRatio\n        limitDPonDisk: $limitDPonDisk\n        limitMPonDstNode: $limitMPonDstNode\n      )\n    }\n  "]))),queryTaskStatus:(0,b.ZP)(u||(u=(0,v.Z)(["\n    query queryTaskStatus($taskID: int32) {\n      queryTaskStatus(taskID: $taskID) {\n        status\n        srcNodesInfo {\n          addr\n          isFinish\n          totalCount\n          migratedCount\n        }\n        dstNodesInfo {\n          addr\n          isFinish\n          totalCount\n          migratedCount\n        }\n      }\n    }\n  "]))),getConfigList:(0,b.ZP)(m||(m=(0,v.Z)(["\n    query getConfigList(\n      $cluster: String\n      $moduleType: Int\n      $operationType: int32\n      $volName: String\n    ) {\n      getConfigList(\n        cluster: $cluster\n        moduleType: $moduleType\n        operationType: $operationType\n        volName: $volName\n      ) {\n        valueName\n        valueDesc\n        valueType\n        value\n        valueForm\n      }\n    }\n  "])))},k=y,_={name:"rebalance",components:{},data:function(){return{query:{cluster:void 0,module:void 0,taskType:null,status:null,zone:void 0},rules:{cluster:[{required:!0,message:"请选择集群",trigger:"blur"}]},list:[],clusterList:[],moduleList:[],typeList:[],zoneList:[],statusList:[],page:{pageSizes:[10,20,30,40],pageNo:1,pageSize:10,totalRecord:0,totalPage:1},showAdd:!1,addForm:{cluster:"",module:"data",concurrency:1,taskType:1},addForm1:{srcNodeList:[],dstNodeList:[],srcNodes:"",dstNodes:"",limitDPonDisk:null,limitMPonDstNode:null,zone:void 0,highRatio:null,lowRatio:null,goalRatio:null},addRules:{cluster:[{required:!0,message:"请选择集群",trigger:"blur"}],concurrency:[{required:!0,message:"请输入迁移并发",trigger:"blur"}]},addRules1:{limitDPonDisk:[{required:!0,message:"请输入最大迁出dp数/盘",trigger:"blur"}],limitMPonDstNode:[{required:!0,message:"请输入目标节点mp上限",trigger:"blur"}],highRatio:[{required:!0,message:"请输入阈值",trigger:"blur"}],lowRatio:[{required:!0,message:"请输入阈值",trigger:"blur"}],goalRatio:[{required:!0,message:"请输入阈值",trigger:"blur"}],zone:[{required:!0,message:"请选择zone",trigger:["blur","change"]}],srcNodes:[{required:!0,message:"请添加源节点",trigger:"blur"}],dstNodes:[{required:!0,message:"请添加目标节点",trigger:"blur"}]},formZoneList:[],showSelectNode:!1,selectForm:{zone:void 0,highRatio:void 0,lowRatio:void 0,ips:[]},selectRules:{zone:[{required:!0,message:"请选择zone",trigger:["blur","change"]}],ips:[{required:!0,message:"请选择IP",trigger:["blur","change"]}]},ipList:[],ishighRatio:!1,showStop:!1,detail:{},showDetail:!1,showEdit:!1,isHigh:void 0,editForm:{taskID:void 0,cluster:"",module:"",taskTypeName:"",taskType:null,zone:"",concurrency:1,goalRatio:null,limitDPonDisk:null,limitMPonDstNode:null},editRules:{goalRatio:[{required:!0,message:"请输入阈值",trigger:"blur"}],limitDPonDisk:[{required:!0,message:"请输入最大迁出dp数/盘",trigger:"blur"}],limitMPonDstNode:[{required:!0,message:"请输入目标节点mp上限",trigger:"blur"}]},taskDetail:{statusName:"",srcNodesInfo:[],dstNodesInfo:[]},isShowRatio:!1,ipRatio:[]}},watch:{},filters:{formatStatus:function(e){switch(e){case 1:return"已完成";case 2:return"迁移中";case 3:return"停止"}}},methods:{init:function(){var e=this;return(0,f.Z)((0,g.Z)().mark((function t(){return(0,g.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.queryCluster();case 2:e.queryModule(),e.queryTypeList(),e.queryZoneList(),e.queryStatusList(),e.queryList();case 7:case"end":return t.stop()}}),t)})))()},changeCluster:function(){this.query.module=void 0,this.query.zone=void 0,this.query.taskType=void 0,this.query.status=void 0,this.queryModule(),this.queryTypeList(),this.queryZoneList(),this.queryStatusList()},changeFormCluster:function(){this.queryZoneList("form"),this.addForm1.zone=void 0},handleSizeChange:function(e){this.page.pageSize=e,this.queryList()},handleCurrentChange:function(e){this.page.pageNo=e,this.queryList()},addTask:function(){this.showAdd=!0,this.$refs["addForm"]&&this.$refs["addForm"].resetFields()},queryList:function(e){var t=this;this.$refs.form.validate((function(o){if(o){var s={page:e&&"reset"==e?1:Number(t.page.pageNo),pageSize:e&&"reset"==e?10:Number(t.page.pageSize)};Object.assign(s,t.query),s.status=Number(s.status),s.taskType=Number(s.taskType),t.apollo.query(t.url.consoleSchedule,k.rebalanceList,s).then((function(e){e.data?(t.list=e.data.rebalanceList.data?e.data.rebalanceList.data:[],t.page.totalRecord=e.data.rebalanceList.total):t.$message.error(e)})).catch((function(e){t.$message.error(e)}))}}))},queryCluster:function(){var e=this,t={name:"cluster"};return new Promise((function(o,s){e.apollo.query(e.url.consoleSchedule,k.dropdownList,t).then((function(t){t.data?(e.clusterList=t.data.dropdownList?t.data.dropdownList:[],e.query.cluster=t.data.dropdownList.length>0?t.data.dropdownList[0].opCode:void 0):e.$message.error(t),o(t.data.dropdownList)})).catch((function(t){e.$message.error(t),s(t)}))}))},queryModule:function(){var e=this,t={name:"module",cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,k.dropdownList,t).then((function(t){t.data?e.moduleList=t.data.dropdownList?t.data.dropdownList:[]:e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},queryTypeList:function(){var e=this,t={name:"taskType",cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,k.dropdownList,t).then((function(t){t.data?e.typeList=t.data.dropdownList?t.data.dropdownList:[]:e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},queryZoneList:function(e){var t=this,o={name:"zone",cluster:e&&"form"==e?this.addForm.cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,k.dropdownList,o).then((function(o){o.data?e&&"form"==e?t.formZoneList=o.data.dropdownList?o.data.dropdownList:[]:t.zoneList=o.data.dropdownList?o.data.dropdownList:[]:(t.$message.error(o),e&&"form"==e?(t.formZoneList=[],t.addForm1.zone=void 0):(t.zoneList=[],t.query.zone=void 0))})).catch((function(e){t.$message.error(e)}))},queryStatusList:function(){var e=this,t={name:"status",cluster:this.query.cluster};this.apollo.query(this.url.consoleSchedule,k.dropdownList,t).then((function(t){t.data?e.statusList=t.data.dropdownList?t.data.dropdownList:[]:e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},addNodeList:function(e){this.showSelectNode=!0,this.$refs["selectForm"]&&this.$refs["selectForm"].resetFields(),this.isHigh=1==e},changeType:function(e){this.$refs["addForm1"].resetFields(),this.addForm1.srcNodes="",this.addForm1.dstNodes=""},changeHigh:function(){this.queryIps(),this.selectForm.ips=[],this.selectForm.ipList=[]},queryIps:function(){var e=this;this.selectForm.ips=[];var t={cluster:this.addForm.cluster,module:this.addForm.module};this.isHigh?t["highRatio"]=this.selectForm.highRatio:t["lowRatio"]=this.selectForm.highRatio,t["zone"]=this.selectForm.zone,this.selectForm.zone&&""!=this.selectForm.zone&&this.apollo.query(this.url.consoleSchedule,k.getNodeUsage,t).then((function(t){t.data?e.ipList=t.data.getNodeUsage?t.data.getNodeUsage.nodes:[]:e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},submitIps:function(){var e=this;this.$refs.selectForm.validate((function(t){t&&(e.isHigh&&(e.addForm1.srcNodes=e.selectForm.ips.join(",")),e.isHigh||(e.addForm1.dstNodes=e.selectForm.ips.join(",")),e.$refs["selectForm"].resetFields(),e.showSelectNode=!1)}))},submitTask:function(){var e=this,t={zone:this.addForm1.zone,highRatio:this.addForm1.highRatio,lowRatio:this.addForm1.lowRatio,goalRatio:this.addForm1.goalRatio,limitDPonDisk:this.addForm1.limitDPonDisk,limitMPonDstNode:this.addForm1.limitMPonDstNode};Object.assign(t,this.addForm),this.apollo.mutation(this.url.consoleSchedule,k.createRebalanceTask,t).then((function(t){200==t.code?(e.showAdd=!1,e.$message.success("操作成功！")):e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},submitNodeTask:function(){var e=this,t={srcNodeList:this.addForm1.srcNodes.split(","),dstNodeList:this.addForm1.dstNodes.split(","),limitDPonDisk:this.addForm1.limitDPonDisk,limitMPonDstNode:this.addForm1.limitMPonDstNode};Object.assign(t,this.addForm),this.apollo.mutation(this.url.consoleSchedule,k.createNodeMigrateTask,t).then((function(t){200==t.code?(e.showAdd=!1,e.$message.success("操作成功！")):e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},validForm:function(e){var t=this;return new Promise((function(o,s){t.$refs[e].validate((function(e){return e?(o(!0),!0):(o(!1),!1)}))}))},submit:function(){var e=this;return(0,f.Z)((0,g.Z)().mark((function t(){var o,s;return(0,g.Z)().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.validForm("addForm");case 2:return o=t.sent,t.next=5,e.validForm("addForm1");case 5:s=t.sent,o&&s&&(1==e.addForm.taskType&&e.submitTask(),2==e.addForm.taskType&&e.submitNodeTask(),e.queryList("reset"));case 7:case"end":return t.stop()}}),t)})))()},stopBalance:function(e){this.showStop=!0,this.detail=e},doStop:function(){var e=this,t={cluster:this.detail.cluster,taskID:this.detail.taskID};this.apollo.mutation(this.url.consoleSchedule,k.stopRebalanceTask,t).then((function(t){t.data?(e.showStop=!1,e.queryList("reset")):e.$message.error(t)})).catch((function(t){e.$message.error(t)}))},goDetail:function(e){this.showDetail=!0,this.getDetail(e.taskID)},getDetail:function(e){var t=this,o={taskID:Number(e)};this.apollo.query(this.url.consoleSchedule,k.queryTaskStatus,o).then((function(e){e.data?e.data.queryTaskStatus&&(t.taskDetail=e.data.queryTaskStatus):(t.taskDetail={statusName:"",srcNodesInfo:[],dstNodesInfo:[]},t.$message.error(e))})).catch((function(e){t.$message.error(e)}))},edit:function(e){this.showEdit=!0,this.$refs["editForm"]&&this.$refs["editForm"].resetFields(),this.editForm.cluster=e.cluster,this.editForm.module=e.module,this.editForm.taskID=e.taskID,this.editForm.taskType=e.taskType,this.editForm.taskTypeName=1==e.taskType?"zone自动均衡":"节点迁移",this.editForm.zone=e.zone,this.editForm.concurrency=e.concurrency,this.editForm.goalRatio=e.goalRatio,this.editForm.limitDPonDisk=e.limitDPonDisk,this.editForm.limitMPonDstNode=e.limitMPonDstNode},submitEdit:function(){var e=this;this.$refs.editForm.validate((function(t){t&&e.apollo.mutation(e.url.consoleSchedule,k.resetControlRebalanceTask,e.editForm).then((function(t){200==t.code?(e.showEdit=!1,e.$message.success("操作成功！"),e.queryList("reset")):e.$message.error(t)})).catch((function(t){e.$message.error(t)}))}))},showRatio:function(){this.isShowRatio=!0,this.getIpRatio()},getIpRatio:function(){var e=this,t={cluster:this.addForm.cluster,module:this.addForm.module};t["zone"]=this.addForm1.zone,this.apollo.query(this.url.consoleSchedule,k.getNodeUsage,t).then((function(t){t.data?e.ipRatio=t.data.getNodeUsage?t.data.getNodeUsage.nodes:[]:e.$message.error(t)})).catch((function(t){e.$message.error(t)}))}},mounted:function(){this.init()}},F=_,$=o(1001),w=(0,$.Z)(F,p,h,!1,null,null,null),D=w.exports},6203:function(e,t,o){var s=o(79989),a=o(68844),i=o(94413),r=o(65290),l=o(16834),n=a([].join),d=i!==Object,c=d||!l("join",",");s({target:"Array",proto:!0,forced:c},{join:function(e){return n(r(this),void 0===e?",":e)}})}}]);